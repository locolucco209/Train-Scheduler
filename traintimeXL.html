<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="UTF-8">
    <title>Metro North</title>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <style>
      .jumbotron {
        background-image: url(images/train.jpg);
        height: 300px;
        background-repeat: no-repeat;
        background-size: cover;
        border-bottom: 1px solid #ff6a00;
        color: white;
      }
    </style>
  </head>

  <body style="background-color: grey;">
    <div class="container">
      <br>
      <!-- Jumbotron -->
      <div class="jumbotron style=">
        <h1 class="text-center">Metro North Train Schedule</h1>
        <p class="text-center">We may be late but at least we work.</p>
      </div>
      <div class="row">

        <!-- Sign-Up Panel-->
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Current Train Schedule</h3>
            </div>
            <div class="panel-body">

              <!-- Sign-up Form (note the various input "types")-->
              <table class="table">
                <thead>
                  <tr>
                    <th>Train Name</th>
                    <th>Destination</th>
                    <th>Frequency (min)</th>
                    <th>Next Arrival</th>
                    <th>Minutes Away</th>
                  </tr>
                </thead>
                <tbody id="mytable">
                </tbody>
              </table>
              </form>
            </div>
          </div>
        </div>

        <!-- Sign-Up Panel-->
        <div class="col-lg-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Add Train</h3>
            </div>
            <div class="panel-body">

              <!-- Sign-up Form (note the various input "types")-->
              <form role="form">
                <div class="form-group">
                  <label for="trainName-input">Train Name</label>
                  <input class="form-control" id="trainName-input" type="text">
                </div>
                <div class="form-group">
                  <label for="destination-input">Destination</label>
                  <input class="form-control" id="destination-input" type="text">
                </div>
                <div class="form-group">
                  <label for="firstTrainTime-input">First Train Time (HH:mm military time)</label>
                  <input class="form-control" id="firstTrainTime-input" type="time">
                </div>
                <div class="form-group">
                  <label for="frequency">Frequency (min)</label>
                  <input class="form-control" id="frequency-input" type="number">
                </div>
                <button class="btn btn-default" id="add-user" type="submit">Submit</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery.js"></script>

    <!-- LINK TO FIREBASE GOES HERE -->
    <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/locale/ca.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.min.js"></script>

    <!-- Script -->
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyBhqheMtyiJiiCuukzFa7cexeJxdnh3rP8",
        authDomain: "train-time-2.firebaseapp.com",
        databaseURL: "https://train-time-2.firebaseio.com",
        projectId: "train-time-2",
        storageBucket: "train-time-2.appspot.com",
        messagingSenderId: "350430585322"
      };
      firebase.initializeApp(config);
      // Create a variable to reference the database
      var database = firebase.database();
      var trainName = "";
      var destination = "";
      var firstTrainTime = "";
      var frequency = "";
      var mydate = "";

      // Capture Button Click
      $("#add-user").on("click", function(event) {
        // Don't refresh the pfirstTrainTime!
        event.preventDefault();

        trainName = $("#trainName-input").val().trim();
        destination = $("#destination-input").val().trim();
        firstTrainTime = $("#firstTrainTime-input").val().trim();
        frequency = $("#frequency-input").val().trim();
        mydate = $("#firstTrainTime-input").val().trim();

        // Code in the logic for storing and retrieving the most recent user.
        database.ref().push({
          trainName: trainName,
          destination: destination,
          firstTrainTime: firstTrainTime,
          frequency: frequency
        });
      });

      database.ref().on("child_added", function(snapshot) {

        // var m =snapshot.val().trainName;
        var a = snapshot.val().trainName
        var b = snapshot.val().destination
        var c = snapshot.val().firstTrainTime
        var d = snapshot.val().frequency
        var current = moment("19851031", "YYYYMMDD").fromNow(); // 6 years ago

        console.log(snapshot.val().trainName, snapshot.val().destination, snapshot.val().firstTrainTime, snapshot.val().frequency)
        addrow(a, b, c, d)

      });
      // database.ref().on("value", function (snapshot) {


      /* $("#trainName-display").text("Train Name: " + snapshot.val().trainName);
       $("#destination-display").text("Destination: " + snapshot.val().destination);
       $("#firstTrainTime-display").text("Train Time: " + snapshot.val().firstTrainTime);*/
      //  })
      function addrow(a, b, c, d, e) {
        $("#mytable").append('<tr><td>' + a + '</td> <td>' + b + '</td><td>' + c + '</td><td>' + d + '</td></tr>')

        /*   var tr = $("<tr>"),
           td = $("<td>").appendTo(tr),
           input = $("input",{type:"text",value:"Enter some text"}).appendTo(td);
           tr.appendTo("#someTable tr");*/
      }
      // moment JS
      /* $('#clock').fitText(1.3);

      function update() {
        $('#trainName').html(moment().format('D. MMMM YYYY H:mm:ss'));
        $('#  destination').html(moment().format('D. MMMM YYYY H:mm:ss'));
        $('#firstTrainTime').html(moment().format('D. MMMM YYYY H:mm:ss'));
        $('#frequency').html(moment().format('D. MMMM YYYY H:mm:ss'));
      }

      setInterval(update, 1000);*/
    </script>

  </body>

</html>